{% extends "base.html" %}

{% block title %}Главная · Командная Викторина{% endblock %}

{% block content %}
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="text-center mb-5">
        <h1 class="display-5 fw-bold">Добро пожаловать в командную Викторину!</h1>
        <p class="lead text-muted">
          Проверьте приложение прямо в браузере: создайте свою команду или присоединитесь к существующей, а затем перейдите к экрану игры.
        </p>
      </div>

      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h2 class="h4 mb-3">Создать команду</h2>
          <form id="create-team-form" action="/team/create" method="post" novalidate>
            <div class="mb-3">
              <label for="team-name" class="form-label">Название команды</label>
              <input type="text" class="form-control" id="team-name" name="team_name" placeholder="Например, Мозговой штурм" required />
            </div>
            <div class="mb-3">
              <label for="create-user" class="form-label">ID пользователя</label>
              <input type="number" class="form-control" id="create-user" name="user_id" placeholder="Введите ID" required />
            </div>
            <button type="submit" class="btn btn-success">Создать команду</button>
          </form>
          <div class="mt-3">
            <h3 class="h6 text-muted">Ответ сервера</h3>
            <pre class="bg-dark text-white p-3 rounded" id="create-team-response">Ожидание запроса…</pre>
          </div>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="h4 mb-3">Присоединиться к команде</h2>
          <form id="join-team-form" action="/team/join" method="post" novalidate>
            <div class="mb-3">
              <label for="join-user" class="form-label">ID пользователя</label>
              <input type="number" class="form-control" id="join-user" name="user_id" placeholder="Введите ID" required />
            </div>
            <div class="mb-3">
              <label for="join-code" class="form-label">Код команды</label>
              <input type="text" class="form-control" id="join-code" name="code" placeholder="Введите код" required />
            </div>
            <button type="submit" class="btn btn-primary">Присоединиться</button>
          </form>
          <div class="mt-3">
            <h3 class="h6 text-muted">Ответ сервера</h3>
            <pre class="bg-dark text-white p-3 rounded" id="join-team-response">Ожидание запроса…</pre>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    const handleFormSubmit = (formId, responseId) => {
      const form = document.getElementById(formId);
      const responseContainer = document.getElementById(responseId);

      if (!form || !responseContainer) return;

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        responseContainer.textContent = "Отправка запроса…";

        const formData = new FormData(form);
        const payload = {};
        formData.forEach((value, key) => {
          payload[key] = value;
        });

        try {
          const fetchResponse = await fetch(form.action, {
            method: form.method.toUpperCase(),
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });

          const data = await fetchResponse.json();
          responseContainer.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
          responseContainer.textContent = `Ошибка: ${error}`;
        }
      });
    };

    handleFormSubmit("create-team-form", "create-team-response");
    handleFormSubmit("join-team-form", "join-team-response");
  </script>
{% endblock %}
