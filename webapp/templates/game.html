{% extends "base.html" %}

{% block content %}
  <div class="container my-4">
    <h2>{{ quiz.title }}</h2>
    <p>{{ quiz.description }}</p>

    {% if feedback %}
      <div class="alert alert-{{ feedback.status }}" role="alert">
        <strong>{{ feedback.message }}</strong>
        {% if answered_question %}
          <div class="mt-2">
            <div class="fw-semibold">–í–æ–ø—Ä–æ—Å:</div>
            <div>{{ answered_question.text }}</div>
          </div>
        {% endif %}
        {% if selected_answer_text %}
          <div class="mt-2">
            <span class="fw-semibold">–í–∞—à –æ—Ç–≤–µ—Ç:</span>
            <span>{{ selected_answer_text }}</span>
          </div>
        {% endif %}
        {% if explanation %}
          <div class="mt-3">
            <span class="fw-semibold">–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:</span>
            <div class="mt-1">{{ explanation }}</div>
          </div>
        {% endif %}
      </div>
    {% endif %}

    {% if question %}
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <h4 class="mb-0">{{ question.text }}</h4>
            <span class="badge text-bg-secondary">–í–æ–ø—Ä–æ—Å {{ current_question_number }} –∏–∑ {{ total_questions }}</span>
          </div>
          <form
            id="answer-form"
            method="get"
            action="{{ url_for('game_screen', match_id=match_id) }}"
          >
            <input type="hidden" name="question_index" value="{{ question_index }}" />
            {% for option in answers %}
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  name="option"
                  value="{{ option.id }}"
                  id="opt{{ option.id }}"
                  {% if loop.first %}required{% endif %}
                >
                <label class="form-check-label" for="opt{{ option.id }}">{{ option.text }}</label>
              </div>
            {% endfor %}
            <button type="submit" class="btn btn-primary mt-3">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
          </form>
        </div>
      </div>
    {% elif total_questions == 0 %}
      <div class="alert alert-secondary" role="alert">
        –ù–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —ç—Ç–æ–π –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞ –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö –≤ Supabase.
      </div>
    {% else %}
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h3 class="h4">–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h3>
          <p class="text-muted mb-4">–í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã. –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É!</p>

          {% if winning_team %}
            <div class="mb-4">
              <div class="fs-4 mb-1">üèÜ {{ winning_team.team_name }}</div>
              <div class="text-secondary">üíØ {{ winning_team.score }} –æ—á–∫–æ–≤</div>
            </div>
          {% else %}
            <p class="mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–∞–Ω–¥ –ø–æ—è–≤—è—Ç—Å—è, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –∏—Ö –æ–ø—É–±–ª–∏–∫—É–µ—Ç.</p>
          {% endif %}

          {% if team_scoreboard %}
            <div class="table-responsive">
              <table class="table table-sm align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th scope="col" class="text-center">–ú–µ—Å—Ç–æ</th>
                    <th scope="col">–ö–æ–º–∞–Ω–¥–∞</th>
                    <th scope="col" class="text-end">–û—á–∫–∏</th>
                  </tr>
                </thead>
                <tbody>
                  {% for entry in team_scoreboard %}
                    {% set rank = loop.index %}
                    {% if rank == 1 %}
                      {% set medal = "ü•á" %}
                    {% elif rank == 2 %}
                      {% set medal = "ü•à" %}
                    {% elif rank == 3 %}
                      {% set medal = "ü•â" %}
                    {% else %}
                      {% set medal = "" %}
                    {% endif %}
                    <tr>
                      <td class="text-center">{{ medal }} {{ rank }}</td>
                      <td>{{ entry.team_name }}</td>
                      <td class="text-end fw-semibold">{{ entry.score }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% endif %}
        </div>
      </div>

      <div class="alert alert-info" role="alert">
        –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ <a href="/team" class="alert-link">—Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ–º–∞–Ω–¥—ã</a>
        –∏–ª–∏ –Ω–∞ <a href="/" class="alert-link">–≥–ª–∞–≤–Ω—É—é</a>.
      </div>
    {% endif %}
  </div>
{% endblock %}