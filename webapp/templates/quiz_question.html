<div id="quiz-body" class="quiz-step">
  <form class="quiz-state">
    <input type="hidden" name="correct_count" value="{{ correct_count }}" />
    <input type="hidden" name="answered_count" value="{{ answered_count }}" />
  </form>
  <div class="quiz-progress">–í–æ–ø—Ä–æ—Å {{ current_question_index }} –∏–∑ {{ total_questions }}</div>
  <h2 class="quiz-question-title">{{ question.text }}</h2>
  {% if question.options %}
    <div class="quiz-options">
      {% for option in question.options %}
        {% set is_selected = selected_option_id is not none and option.id == selected_option_id %}
        {% set is_correct_option = question.correct_option_id is not none and option.id == question.correct_option_id %}
        <button
          type="button"
          class="option-button{% if show_result and is_correct_option %} is-correct{% endif %}{% if show_result and is_selected and not is_correct_option %} is-incorrect{% endif %}"
          hx-post="/quiz/{{ quiz_id }}/answer/{{ question.id }}"
          hx-target="#quiz-body"
          hx-swap="outerHTML"
          hx-include="#quiz-body form.quiz-state"
          hx-vals='{"option_id": {{ option.id }}}'
          hx-indicator=".htmx-indicator"
          {% if show_result %}disabled{% endif %}
        >
          <span class="option-index">{{ loop.index }}</span>
          <span class="option-text">{{ option.text }}</span>
        </button>
      {% endfor %}
    </div>
  {% endif %}

  {% if show_result %}
    <div class="answer-feedback{% if is_correct %} is-correct{% else %} is-incorrect{% endif %}">
      {% if is_correct %}
        üëç –í–µ—Ä–Ω–æ! –ú–æ–ª–æ–¥–µ—Ü.
      {% else %}
        ‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑.
      {% endif %}
    </div>
    {% if question.explanation %}
      <p class="explanation">{{ question.explanation }}</p>
    {% endif %}
    {% if quiz_completed %}
      <div class="quiz-summary">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
        <p>–í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ {{ correct_count }} –∏–∑ {{ total_questions }} –≤–æ–ø—Ä–æ—Å–æ–≤.</p>
        <button
          type="button"
          class="back-to-categories"
          hx-get="/"
          hx-target="#content"
          hx-push-url="true"
          hx-indicator=".htmx-indicator"
        >
          –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        </button>
      </div>
    {% elif next_question_id %}
      <div class="quiz-actions">
        <button
          type="button"
          class="next-question"
          hx-get="/quiz/{{ quiz_id }}/question/{{ next_question_id }}"
          hx-target="#quiz-body"
          hx-swap="outerHTML"
          hx-include="#quiz-body form.quiz-state"
          hx-indicator=".htmx-indicator"
        >
          –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
        </button>
      </div>
    {% endif %}
  {% endif %}
</div>
